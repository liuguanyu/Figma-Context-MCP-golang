# Figma MCP Server - Golangé‡æ„åˆ†æä¸å®ç°æ–¹æ¡ˆ

## ç›®æ ‡
è§£å†³Node.jsåœ¨å¤„ç†å¤§å“åº”ï¼ˆ~740KBï¼‰æ—¶çš„æ€§èƒ½ç“¶é¢ˆï¼Œç‰¹åˆ«æ˜¯`parseFigmaResponse`å‡½æ•°çš„æ•ˆç‡é—®é¢˜ï¼Œç”¨Golangé‡æ–°å®ç°æ•´ä¸ªæœåŠ¡ã€‚

## ç°æœ‰æœåŠ¡æ¶æ„åˆ†æ

### 1. æœåŠ¡ç«¯ç‚¹ (Endpoints)

#### ä¸»è¦HTTPç«¯ç‚¹
- **`/health`** (GET) - å¥åº·æ£€æŸ¥ç«¯ç‚¹
  - è¾“å‡º: `{"status":"healthy","timestamp":"...","server":"Figma MCP Server","version":"..."}`

- **`/mcp`** (POST) - StreamableHTTP MCPåè®®ç«¯ç‚¹
  - è¾“å…¥: MCP JSON-RPCåè®®æ¶ˆæ¯
  - è¾“å‡º: Server-Sent Events (SSE) æµ
  - æ”¯æŒä¼šè¯ç®¡ç† (MCP-Session-ID header)

#### è¾…åŠ©ç«¯ç‚¹
- **`/sse`** - SSEè¿æ¥ç«¯ç‚¹
- **`/messages`** - æ¶ˆæ¯ç«¯ç‚¹

### 2. MCPåè®®å·¥å…· (Tools)

#### `get_figma_data`
- **æè¿°**: è·å–Figmaæ–‡ä»¶çš„å¸ƒå±€ä¿¡æ¯
- **è¾“å…¥å‚æ•°**:
  ```json
  {
    "figmaApiKey": "string (required)" - Figma APIè®¤è¯å¯†é’¥
    "fileKey": "string (required)" - Figmaæ–‡ä»¶ID
    "nodeId": "string (optional)" - ç‰¹å®šèŠ‚ç‚¹ID
    "depth": "number (optional)" - éå†æ·±åº¦
  }
  ```
- **è¾“å‡º**: å®Œæ•´çš„Figmaæ–‡ä»¶ç»“æ„æ•°æ®ï¼ˆç»è¿‡ç®€åŒ–å¤„ç†ï¼‰

#### `download_figma_images`  
- **æè¿°**: ä¸‹è½½Figmaæ–‡ä»¶ä¸­çš„SVG/PNGå›¾åƒ
- **è¾“å…¥å‚æ•°**:
  ```json
  {
    "figmaApiKey": "string (required)",
    "fileKey": "string (required)", 
    "nodes": "array (required)" - åŒ…å«nodeIdã€fileNameç­‰çš„èŠ‚ç‚¹æ•°ç»„
    "localPath": "string (required)" - æœ¬åœ°å­˜å‚¨è·¯å¾„
    "pngScale": "number (optional)" - PNGç¼©æ”¾æ¯”ä¾‹
    "svgOptions": "object (optional)" - SVGå¯¼å‡ºé€‰é¡¹
  }
  ```

### 3. æ¨¡å—åˆ’åˆ†

#### æ ¸å¿ƒæ¨¡å—
1. **HTTPæœåŠ¡å™¨** (`src/server.ts`)
   - Express.js HTTPæœåŠ¡å™¨
   - è·¯ç”±å¤„ç†
   - SSEæ”¯æŒ

2. **MCPåè®®å¤„ç†** (`src/mcp.ts`)
   - MCP JSON-RPCåè®®å®ç°
   - å·¥å…·æ³¨å†Œå’Œè°ƒåº¦
   - ä¼šè¯ç®¡ç†

3. **FigmaæœåŠ¡** (`src/services/figma.ts`)
   - Figma APIè°ƒç”¨
   - è®¤è¯å¤„ç†
   - å“åº”ç®€åŒ– âš ï¸ **æ€§èƒ½ç“¶é¢ˆä½ç½®**

4. **å“åº”ç®€åŒ–å™¨** (`src/services/simplify-node-response.ts`)
   - å¤§JSONå“åº”å¤„ç† âš ï¸ **æ€§èƒ½ç“¶é¢ˆä½ç½®**
   - èŠ‚ç‚¹æ•°æ®æ¸…ç†å’Œè½¬æ¢

#### å·¥å…·æ¨¡å—  
1. **æ ·å¼è½¬æ¢å™¨** (`src/transformers/`)
   - æ•ˆæœå¤„ç† (`effects.ts`)
   - å¸ƒå±€å¤„ç† (`layout.ts`) 
   - æ ·å¼å¤„ç† (`style.ts`)

2. **å·¥å…·å‡½æ•°** (`src/utils/`)
   - ç½‘ç»œé‡è¯• (`fetch-with-retry.ts`)
   - æ—¥å¿—è®°å½• (`logger.ts`)
   - æ•°æ®æ¸…ç† (`sanitization.ts`)

### 4. å…³é”®æ€§èƒ½ç“¶é¢ˆåˆ†æ

#### ä¸»è¦é—®é¢˜: `parseFigmaResponse` å‡½æ•°
ä½ç½®: `src/services/figma.ts` ç¬¬çº¦120è¡Œ
```typescript
const simplifiedResponse = parseFigmaResponse(response);
```

#### ç“¶é¢ˆåŸå› :
1. **å¤§JSONå¤„ç†**: ~740KBçš„å“åº”æ•°æ®
2. **æ·±åº¦é€’å½’**: å¤æ‚çš„èŠ‚ç‚¹æ ‘éå†
3. **å†…å­˜åˆ†é…**: JavaScriptå¯¹è±¡åˆ›å»ºå’ŒGCå‹åŠ›
4. **å•çº¿ç¨‹é˜»å¡**: Node.jsä¸»çº¿ç¨‹é˜»å¡

### 5. Figma APIè°ƒç”¨è§„èŒƒ

#### è®¤è¯æ–¹å¼
- ä½¿ç”¨Personal Access Token
- Header: `X-Figma-Token: {figmaApiKey}`

#### ä¸»è¦APIç«¯ç‚¹
1. **è·å–æ–‡ä»¶æ•°æ®**: `GET https://api.figma.com/v1/files/{fileKey}`
2. **è·å–å›¾åƒ**: `GET https://api.figma.com/v1/images/{fileKey}`

## Golangå®ç°æ–¹æ¡ˆ

### 1. æ¶æ„è®¾è®¡

```
figma-mcp-golang/
â”œâ”€â”€ main.go                 # ä¸»å…¥å£
â”œâ”€â”€ go.mod                  # ä¾èµ–ç®¡ç†
â”œâ”€â”€ server/                 # HTTPæœåŠ¡å™¨
â”‚   â”œâ”€â”€ server.go          # æœåŠ¡å™¨ä¸»ä½“
â”‚   â”œâ”€â”€ handlers.go        # HTTPå¤„ç†å™¨
â”‚   â””â”€â”€ sse.go             # SSEå®ç°
â”œâ”€â”€ mcp/                    # MCPåè®®å¤„ç†
â”‚   â”œâ”€â”€ protocol.go        # åè®®å®šä¹‰
â”‚   â”œâ”€â”€ session.go         # ä¼šè¯ç®¡ç†
â”‚   â””â”€â”€ tools.go           # å·¥å…·å®ç°
â”œâ”€â”€ figma/                  # Figmaç›¸å…³æœåŠ¡
â”‚   â”œâ”€â”€ client.go          # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ parser.go          # å“åº”è§£æå™¨ (æ€§èƒ½ä¼˜åŒ–é‡ç‚¹)
â”‚   â””â”€â”€ downloader.go      # å›¾åƒä¸‹è½½å™¨
â”œâ”€â”€ types/                  # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ figma.go           # Figma APIç±»å‹
â”‚   â””â”€â”€ mcp.go             # MCPåè®®ç±»å‹
â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
    â”œâ”€â”€ logger.go          # æ—¥å¿—
    â””â”€â”€ http.go            # HTTPå·¥å…·
```

### 2. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### JSONå¤„ç†ä¼˜åŒ–
1. **æµå¼è§£æ**: ä½¿ç”¨`encoding/json`çš„Decoderè¿›è¡Œæµå¼å¤„ç†
2. **å†…å­˜æ± **: å¤ç”¨å¯¹è±¡é¿å…é¢‘ç¹åˆ†é…
3. **å¹¶å‘å¤„ç†**: å¤§æ•°æ®ç»“æ„çš„å¹¶è¡Œå¤„ç†

#### å“åº”ç®€åŒ–ä¼˜åŒ–
1. **é¢„åˆ†é…åˆ‡ç‰‡**: å‡å°‘åŠ¨æ€æ‰©å®¹
2. **ç›´æ¥æ˜ å°„**: é¿å…æ·±æ‹·è´
3. **æ‡’åŠ è½½**: æŒ‰éœ€å¤„ç†èŠ‚ç‚¹æ•°æ®

#### ç½‘ç»œä¼˜åŒ–
1. **HTTP/2**: æ”¯æŒå¤šè·¯å¤ç”¨
2. **è¿æ¥æ± **: å¤ç”¨TCPè¿æ¥
3. **å‹ç¼©**: å¯ç”¨gzipå‹ç¼©

### 3. æ ¸å¿ƒæ¥å£ä¿æŒä¸€è‡´

#### HTTPæ¥å£
- ç«¯å£: 3333 (å¯é…ç½®)
- è·¯å¾„: å®Œå…¨å…¼å®¹ç°æœ‰æ¥å£
- å“åº”æ ¼å¼: ä¿æŒSSEæ ¼å¼ä¸å˜

#### MCPå·¥å…·æ¥å£  
- å·¥å…·åç§°: `get_figma_data`, `download_figma_images`
- å‚æ•°ç»“æ„: å®Œå…¨å…¼å®¹
- å“åº”æ ¼å¼: JSON-RPC 2.0æ ‡å‡†

### 4. å…³é”®å®ç°è¦ç‚¹

#### figmaApiKeyå¤„ç†
- âŒ ä¸ä»ç¯å¢ƒå˜é‡è¯»å–
- âœ… ç›´æ¥ä»è¯·æ±‚å‚æ•°è·å–
- æ¯ä¸ªå·¥å…·è°ƒç”¨éƒ½éœ€è¦ä¼ é€’API key

#### ä¼šè¯ç®¡ç†
- æ”¯æŒMCP-Session-ID header
- å†…å­˜ä¸­ç»´æŠ¤ä¼šè¯çŠ¶æ€
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯

#### é”™è¯¯å¤„ç†
- ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- Figma APIé”™è¯¯ä¼ æ’­
- ä¼˜é›…é™çº§å¤„ç†

### 5. éƒ¨ç½²å’Œæµ‹è¯•

#### ç¼–è¯‘
```bash
cd figma-mcp-golang
go mod tidy
go build -o figma-mcp-server main.go
```

#### è¿è¡Œ
```bash
./figma-mcp-server -port 3333
```

#### æµ‹è¯•å…¼å®¹æ€§
- ç°æœ‰çš„Javaæµ‹è¯•æ–‡ä»¶æ— éœ€ä¿®æ”¹
- æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹åº”è¯¥é€šè¿‡
- æ€§èƒ½åº”æœ‰æ˜¾è‘—æå‡

## é¢„æœŸæ€§èƒ½æå‡

1. **å“åº”æ—¶é—´**: 740KBå“åº”å¤„ç†æ—¶é—´ä»ç§’çº§é™ä½åˆ°æ¯«ç§’çº§
2. **å†…å­˜ä½¿ç”¨**: Golangçš„æ›´é«˜æ•ˆå†…å­˜ç®¡ç†
3. **å¹¶å‘èƒ½åŠ›**: åŸç”Ÿåç¨‹æ”¯æŒæ›´å¥½çš„å¹¶å‘å¤„ç†
4. **CPUä½¿ç”¨ç‡**: æ›´é«˜æ•ˆçš„JSONå¤„ç†ç®—æ³•

## å®æ–½æ­¥éª¤

1. âœ… åˆ›å»ºé¡¹ç›®structureå’Œåˆ†ææ–‡æ¡£
2. ğŸ”„ å®ç°åŸºç¡€HTTPæœåŠ¡å™¨å’Œå¥åº·æ£€æŸ¥
3. ğŸ”„ å®ç°MCPåè®®å±‚
4. ğŸ”„ å®ç°Figma APIå®¢æˆ·ç«¯
5. ğŸ”„ ä¼˜åŒ–JSONè§£æå™¨ï¼ˆé‡ç‚¹ï¼‰
6. ğŸ”„ å®ç°å·¥å…·é€»è¾‘
7. ğŸ”„ é›†æˆæµ‹è¯•å’Œæ€§èƒ½éªŒè¯
